"use strict";(globalThis["webpackChunkwehlo_app"]=globalThis["webpackChunkwehlo_app"]||[]).push([[919],{1256:(e,t,a)=>{a.d(t,{A:()=>x});a(310),a(5962);var i=a(1758),r=a(8790);const s={class:"text-h6"};function l(e,t,a,l,n,o){const u=(0,i.g2)("q-select"),d=(0,i.g2)("q-btn"),c=(0,i.g2)("q-btn-group"),p=(0,i.g2)("q-card-section"),y=(0,i.g2)("q-separator"),h=(0,i.g2)("apexchart"),m=(0,i.g2)("q-spinner"),b=(0,i.g2)("q-inner-loading"),v=(0,i.g2)("q-card");return(0,i.uX)(),(0,i.Wv)(v,{flat:"",bordered:""},{default:(0,i.k6)((()=>[(0,i.bF)(p,{class:"row items-center justify-between"},{default:(0,i.k6)((()=>[(0,i.Lk)("div",s,(0,r.v_)(a.title),1),(0,i.bF)(c,{spread:""},{default:(0,i.k6)((()=>["Daily"===n.viewType?((0,i.uX)(),(0,i.Wv)(u,{key:0,dense:"",square:"",filled:"",label:"Month",modelValue:n.filter.month,"onUpdate:modelValue":[t[0]||(t[0]=e=>n.filter.month=e),o.index],options:n.monthsOptions,"map-options":"","emit-value":"","option-label":"label","option-value":"value",color:"secondary"},null,8,["modelValue","options","onUpdate:modelValue"])):(0,i.Q3)("",!0),"Daily"===n.viewType?((0,i.uX)(),(0,i.Wv)(u,{key:1,dense:"",square:"",filled:"",label:"Year",modelValue:n.filter.year,"onUpdate:modelValue":[t[1]||(t[1]=e=>n.filter.year=e),o.index],options:o.yearOptions,color:"secondary"},null,8,["modelValue","options","onUpdate:modelValue"])):(0,i.Q3)("",!0),(0,i.bF)(d,{color:"Live"===n.viewType?"secondary":"grey",label:"Live",onClick:t[2]||(t[2]=e=>o.switchView("Live"))},null,8,["color"]),(0,i.bF)(d,{color:"Daily"===n.viewType?"secondary":"grey",label:"Daily",onClick:t[3]||(t[3]=e=>o.switchView("Daily"))},null,8,["color"])])),_:1})])),_:1}),(0,i.bF)(y),(0,i.bF)(p,null,{default:(0,i.k6)((()=>[((0,i.uX)(),(0,i.Wv)(h,{key:a.sensor,type:"line",height:"320",options:o.chartOptions,series:n.series},null,8,["options","series"]))])),_:1}),(0,i.bF)(b,{showing:n.preload},{default:(0,i.k6)((()=>[(0,i.bF)(m,{size:"50px",color:"primary"})])),_:1},8,["showing"])])),_:1})}a(95),a(6724);var n=a(6246),o=a(8734);const u=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function d(e,t){const a=e.map((e=>{if(Array.isArray(e))return Number.isFinite(Number(e[1]))?Number(e[1]):null;const t=Number(e);return Number.isFinite(t)?t:null}));if(t){a.length=t;for(let e=0;e<t;e++)"undefined"===typeof a[e]&&(a[e]=null)}return a}function c(e,t){for(let a=0;a<e.length;a++){const i=e[a];if(Array.isArray(i)||i&&"object"===typeof i)throw console.error(`Category mode received non-scalar at index ${a} for ${t}:`,i),new Error("Category series must be numbers/nulls only")}}const p={name:"SensorChart",props:{sensor:{type:String,required:!0},title:{type:String,default:""}},emits:["ready"],data(){const e=Date.now(),t=n.Ay.formatDate(e,"YYYY"),a=n.Ay.formatDate(e,"MM");return{preload:!0,viewType:"Live",filter:{month:a,year:t},categories:[],series:[{name:this.title||"",data:[]}],baseOptions:(0,o.IG)({chart:{id:this.sensor,zoom:{enabled:!1},toolbar:{show:!1},animations:{enabled:!1},parentHeightOffset:0,redrawOnWindowResize:!1,redrawOnParentResize:!1},stroke:{curve:"smooth",width:2},markers:{size:0},dataLabels:{enabled:!1},legend:{show:!1},grid:{padding:{left:8,right:8}},yaxis:{labels:{formatter:e=>null==e||isNaN(e)?"":Math.round(e)}},tooltip:{},responsive:[{breakpoint:600,options:{chart:{height:260},markers:{size:0}}}]}),monthsOptions:[{value:"01",label:"January"},{value:"02",label:"February"},{value:"03",label:"March"},{value:"04",label:"April"},{value:"05",label:"May"},{value:"06",label:"June"},{value:"07",label:"July"},{value:"08",label:"August"},{value:"09",label:"September"},{value:"10",label:"October"},{value:"11",label:"November"},{value:"12",label:"December"}]}},computed:{yearOptions(){const e=Number(this.filter.year||n.Ay.formatDate(Date.now(),"YYYY")),t=e-3,a=e+5;return Array.from({length:a-t+1},((e,a)=>String(t+a)))},chartOptions(){const e="Live"===this.viewType||"Daily"===this.viewType;return e?{...this.baseOptions,xaxis:{type:"datetime",categories:[],labels:{datetimeUTC:!0}},tooltip:{x:{format:"dd MMM yyyy HH:mm"}}}:{...this.baseOptions,xaxis:{type:"category",categories:this.categories,labels:{}},tooltip:{x:{formatter:(e,t)=>{const a=t&&t.dataPointIndex,i=t&&t.w&&t.w.globals&&t.w.globals.categoryLabels||this.categories;return null!=a&&i&&null!=i[a]?String(i[a]):String(e)}}}}}},async mounted(){this.$nextTick((()=>this.$emit("ready",this.sensor))),this.index()},methods:{switchView(e){this.viewType!==e&&(this.viewType=e,"Live"!==e&&"Daily"!==e||(this.categories=[]),this.index())},buildUrl(){const e="app/get-all-data",t=new URLSearchParams({device_uuid:this.$route.params.uuid,sensor:this.sensor,view_type:this.viewType});return"Daily"===this.viewType?(t.set("year",this.filter.year),t.set("month",this.filter.month)):"Monthly"===this.viewType&&t.set("year",this.filter.year),`${e}?${t.toString()}`},applyResponse(e){const t=e&&e.rawResults||[];if("Monthly"===this.viewType){const e=Array(12).fill(null);t.forEach((t=>{const a=Number(t.month??t.m??t[0]),i=Number(t.avg??t.value??t[1]);a>=1&&a<=12&&(e[a-1]=Number.isFinite(i)?i:null)})),this.categories=u;const a=d(e,12);c(a,"Monthly"),this.series=[{name:this.title||"",data:a}]}else if("Yearly"===this.viewType){const e=t.map((e=>({y:Number(e.year??e.y??e[0]),v:Number(e.avg??e.value??e[1])}))).filter((e=>Number.isFinite(e.y))).sort(((e,t)=>e.y-t.y));this.categories=e.map((e=>String(e.y)));const a=d(e.map((e=>Number.isFinite(e.v)?e.v:null)));c(a,"Yearly"),this.series=[{name:this.title||"",data:a}]}else{const e=t.map((e=>{if(Array.isArray(e))return[Number(e[0]),Number(e[1])];const t=e.timestamp||e.created_at||e.ts||e[0],a=e.value??e.avg??e.y??e[1];return[Number(t),Number(a)]})).filter((([e,t])=>Number.isFinite(e)&&Number.isFinite(t)));this.categories=[],this.series=[{name:this.title||"",data:e}]}},async index(){this.preload=!0;try{const{data:e}=await this.$api.get(this.buildUrl());this.applyResponse(e||{})}catch(e){console.error(e),this.series=[{name:this.title||"",data:[]}],this.categories=[]}finally{this.preload=!1,await(0,i.dY)(),this.$emit("ready",this.sensor)}}}};var y=a(2807),h=a(3316),m=a(4189),b=a(6031),v=a(595),g=a(2374),f=a(386),w=a(9035),A=a(8210),k=a(8582),N=a.n(k);const F=(0,y.A)(p,[["render",l]]),x=F;N()(p,"components",{QCard:h.A,QCardSection:m.A,QBtnGroup:b.A,QSelect:v.A,QBtn:g.A,QSeparator:f.A,QInnerLoading:w.A,QSpinner:A.A})},1919:(e,t,a)=>{a.r(t),a.d(t,{default:()=>h});var i=a(1758);function r(e,t,a,r,s,l){const n=(0,i.g2)("q-card-section"),o=(0,i.g2)("my-chart"),u=(0,i.g2)("q-card"),d=(0,i.g2)("q-page");return(0,i.uX)(),(0,i.Wv)(d,{padding:""},{default:(0,i.k6)((()=>[(0,i.bF)(u,null,{default:(0,i.k6)((()=>[(0,i.bF)(n,null,{default:(0,i.k6)((()=>t[0]||(t[0]=[(0,i.Lk)("div",{class:"text-h6"},"Sales Overview",-1)]))),_:1}),(0,i.bF)(n,null,{default:(0,i.k6)((()=>[(0,i.bF)(o)])),_:1})])),_:1})])),_:1})}var s=a(1256);const l={components:{MyChart:s.A}};var n=a(2807),o=a(7716),u=a(3316),d=a(4189),c=a(8582),p=a.n(c);const y=(0,n.A)(l,[["render",r]]),h=y;p()(l,"components",{QPage:o.A,QCard:u.A,QCardSection:d.A})}}]);