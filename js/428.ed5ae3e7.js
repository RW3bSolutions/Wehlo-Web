"use strict";(globalThis["webpackChunkwehlo_app"]=globalThis["webpackChunkwehlo_app"]||[]).push([[428],{1256:(e,t,i)=>{i.d(t,{A:()=>F});i(310),i(5962);var r=i(1758),a=i(8790);const s={class:"text-h6"};function l(e,t,i,l,o,n){const c=(0,r.g2)("q-select"),u=(0,r.g2)("q-btn"),d=(0,r.g2)("q-btn-group"),p=(0,r.g2)("q-card-section"),m=(0,r.g2)("q-separator"),y=(0,r.g2)("apexchart"),h=(0,r.g2)("q-spinner"),v=(0,r.g2)("q-inner-loading"),b=(0,r.g2)("q-card");return(0,r.uX)(),(0,r.Wv)(b,{flat:"",bordered:""},{default:(0,r.k6)((()=>[(0,r.bF)(p,{class:"row items-center justify-between"},{default:(0,r.k6)((()=>[(0,r.Lk)("div",s,(0,a.v_)(i.title),1),(0,r.bF)(d,{spread:""},{default:(0,r.k6)((()=>["Daily"===o.viewType?((0,r.uX)(),(0,r.Wv)(c,{key:0,dense:"",square:"",filled:"",label:"Month",modelValue:o.filter.month,"onUpdate:modelValue":[t[0]||(t[0]=e=>o.filter.month=e),n.index],options:o.monthsOptions,"map-options":"","emit-value":"","option-label":"label","option-value":"value",color:"secondary"},null,8,["modelValue","options","onUpdate:modelValue"])):(0,r.Q3)("",!0),"Daily"===o.viewType?((0,r.uX)(),(0,r.Wv)(c,{key:1,dense:"",square:"",filled:"",label:"Year",modelValue:o.filter.year,"onUpdate:modelValue":[t[1]||(t[1]=e=>o.filter.year=e),n.index],options:n.yearOptions,color:"secondary"},null,8,["modelValue","options","onUpdate:modelValue"])):(0,r.Q3)("",!0),(0,r.bF)(u,{color:"Live"===o.viewType?"secondary":"grey",label:"Live",onClick:t[2]||(t[2]=e=>n.switchView("Live"))},null,8,["color"]),(0,r.bF)(u,{color:"Daily"===o.viewType?"secondary":"grey",label:"Daily",onClick:t[3]||(t[3]=e=>n.switchView("Daily"))},null,8,["color"])])),_:1})])),_:1}),(0,r.bF)(m),(0,r.bF)(p,null,{default:(0,r.k6)((()=>[((0,r.uX)(),(0,r.Wv)(y,{key:i.sensor,type:"line",height:"320",options:n.chartOptions,series:o.series},null,8,["options","series"]))])),_:1}),(0,r.bF)(v,{showing:o.preload},{default:(0,r.k6)((()=>[(0,r.bF)(h,{size:"50px",color:"primary"})])),_:1},8,["showing"])])),_:1})}i(95),i(6724);var o=i(6246),n=i(8734);const c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function u(e,t){const i=e.map((e=>{if(Array.isArray(e))return Number.isFinite(Number(e[1]))?Number(e[1]):null;const t=Number(e);return Number.isFinite(t)?t:null}));if(t){i.length=t;for(let e=0;e<t;e++)"undefined"===typeof i[e]&&(i[e]=null)}return i}function d(e,t){for(let i=0;i<e.length;i++){const r=e[i];if(Array.isArray(r)||r&&"object"===typeof r)throw console.error(`Category mode received non-scalar at index ${i} for ${t}:`,r),new Error("Category series must be numbers/nulls only")}}const p={name:"SensorChart",props:{sensor:{type:String,required:!0},title:{type:String,default:""}},emits:["ready"],data(){const e=Date.now(),t=o.Ay.formatDate(e,"YYYY"),i=o.Ay.formatDate(e,"MM");return{preload:!0,viewType:"Live",filter:{month:i,year:t},categories:[],series:[{name:this.title||"",data:[]}],baseOptions:(0,n.IG)({chart:{id:this.sensor,zoom:{enabled:!1},toolbar:{show:!1},animations:{enabled:!1},parentHeightOffset:0,redrawOnWindowResize:!1,redrawOnParentResize:!1},stroke:{curve:"smooth",width:2},markers:{size:0},dataLabels:{enabled:!1},legend:{show:!1},grid:{padding:{left:8,right:8}},yaxis:{labels:{formatter:e=>null==e||isNaN(e)?"":Math.round(e)}},tooltip:{},responsive:[{breakpoint:600,options:{chart:{height:260},markers:{size:0}}}]}),monthsOptions:[{value:"01",label:"January"},{value:"02",label:"February"},{value:"03",label:"March"},{value:"04",label:"April"},{value:"05",label:"May"},{value:"06",label:"June"},{value:"07",label:"July"},{value:"08",label:"August"},{value:"09",label:"September"},{value:"10",label:"October"},{value:"11",label:"November"},{value:"12",label:"December"}]}},computed:{yearOptions(){const e=Number(this.filter.year||o.Ay.formatDate(Date.now(),"YYYY")),t=e-3,i=e+5;return Array.from({length:i-t+1},((e,i)=>String(t+i)))},chartOptions(){const e="Live"===this.viewType||"Daily"===this.viewType;return e?{...this.baseOptions,xaxis:{type:"datetime",categories:[],labels:{datetimeUTC:!0}},tooltip:{x:{format:"dd MMM yyyy HH:mm"}}}:{...this.baseOptions,xaxis:{type:"category",categories:this.categories,labels:{}},tooltip:{x:{formatter:(e,t)=>{const i=t&&t.dataPointIndex,r=t&&t.w&&t.w.globals&&t.w.globals.categoryLabels||this.categories;return null!=i&&r&&null!=r[i]?String(r[i]):String(e)}}}}}},async mounted(){this.$nextTick((()=>this.$emit("ready",this.sensor))),this.index()},methods:{switchView(e){this.viewType!==e&&(this.viewType=e,"Live"!==e&&"Daily"!==e||(this.categories=[]),this.index())},buildUrl(){const e="app/get-all-data",t=new URLSearchParams({device_uuid:this.$route.params.uuid,sensor:this.sensor,view_type:this.viewType});return"Daily"===this.viewType?(t.set("year",this.filter.year),t.set("month",this.filter.month)):"Monthly"===this.viewType&&t.set("year",this.filter.year),`${e}?${t.toString()}`},applyResponse(e){const t=e&&e.rawResults||[];if("Monthly"===this.viewType){const e=Array(12).fill(null);t.forEach((t=>{const i=Number(t.month??t.m??t[0]),r=Number(t.avg??t.value??t[1]);i>=1&&i<=12&&(e[i-1]=Number.isFinite(r)?r:null)})),this.categories=c;const i=u(e,12);d(i,"Monthly"),this.series=[{name:this.title||"",data:i}]}else if("Yearly"===this.viewType){const e=t.map((e=>({y:Number(e.year??e.y??e[0]),v:Number(e.avg??e.value??e[1])}))).filter((e=>Number.isFinite(e.y))).sort(((e,t)=>e.y-t.y));this.categories=e.map((e=>String(e.y)));const i=u(e.map((e=>Number.isFinite(e.v)?e.v:null)));d(i,"Yearly"),this.series=[{name:this.title||"",data:i}]}else{const e=t.map((e=>{if(Array.isArray(e))return[Number(e[0]),Number(e[1])];const t=e.timestamp||e.created_at||e.ts||e[0],i=e.value??e.avg??e.y??e[1];return[Number(t),Number(i)]})).filter((([e,t])=>Number.isFinite(e)&&Number.isFinite(t)));this.categories=[],this.series=[{name:this.title||"",data:e}]}},async index(){this.preload=!0;try{const{data:e}=await this.$api.get(this.buildUrl());this.applyResponse(e||{})}catch(e){console.error(e),this.series=[{name:this.title||"",data:[]}],this.categories=[]}finally{this.preload=!1,await(0,r.dY)(),this.$emit("ready",this.sensor)}}}};var m=i(2807),y=i(3316),h=i(4189),v=i(6031),b=i(595),g=i(2374),_=i(386),w=i(9035),f=i(8210),k=i(8582),S=i.n(k);const A=(0,m.A)(p,[["render",l]]),F=A;S()(p,"components",{QCard:y.A,QCardSection:h.A,QBtnGroup:v.A,QSelect:b.A,QBtn:g.A,QSeparator:_.A,QInnerLoading:w.A,QSpinner:f.A})},1428:(e,t,i)=>{i.r(t),i.d(t,{default:()=>R});var r=i(1758),a=i(8790);const s={key:0,class:"row"},l={class:"col-12 text-center"},o={key:1,class:"row"},n={class:"col-12 col-sm-12 col-md-5 col-lg-3 q-pa-sm"},c={key:0,class:"col-12 col-sm-12 col-md-7 col-lg-9 q-pa-sm"},u={key:1,class:"col-12 col-sm-12 col-md-7 col-lg-9 q-pa-sm"},d={key:2,class:"col-12 col-sm-12 col-md-7 col-lg-9 q-pa-sm"},p={key:3,class:"col-12 col-sm-12 col-md-7 col-lg-9 q-pa-sm"},m={key:4,class:"col-12 col-sm-12 col-md-7 col-lg-9 q-pa-sm"},y={key:5,class:"col-12 col-sm-12 col-md-7 col-lg-9 q-pa-sm"},h={key:6,class:"col-12 col-sm-12 col-md-7 col-lg-9 q-pa-sm"},v={key:7,class:"col-12 col-sm-12 col-md-7 col-lg-9 q-pa-sm"},b={key:8,class:"col-12 col-sm-12 col-md-7 col-lg-9 q-pa-sm"},g={key:9,class:"col-12 col-sm-12 col-md-7 col-lg-9 q-pa-sm"},_={key:10,class:"col-12 col-sm-12 col-md-7 col-lg-9 q-pa-sm"},w={key:11,class:"col-12 col-sm-12 col-md-7 col-lg-9 q-pa-sm"},f={key:12,class:"col-12 col-sm-12 col-md-7 col-lg-9 q-pa-sm"},k={key:13,class:"col-12 col-sm-12 col-md-7 col-lg-9 q-pa-sm"},S={key:14,class:"col-12 col-sm-12 col-md-7 col-lg-9 q-pa-sm"};function A(e,t,i,A,F,q){const x=(0,r.g2)("q-spinner"),C=(0,r.g2)("q-radio"),Q=(0,r.g2)("q-item-section"),L=(0,r.g2)("q-img"),E=(0,r.g2)("q-item-label"),N=(0,r.g2)("q-item"),X=(0,r.g2)("q-list"),T=(0,r.g2)("MyChart"),M=(0,r.g2)("q-page"),V=(0,r.gN)("ripple");return(0,r.uX)(),(0,r.Wv)(M,{class:"q-pa-sm"},{default:(0,r.k6)((()=>[e.preload?((0,r.uX)(),(0,r.CE)("div",s,[(0,r.Lk)("div",l,[(0,r.bF)(x,{color:"primary",size:"3em",thickness:10}),t[1]||(t[1]=(0,r.Lk)("div",null,"Loading...",-1))])])):((0,r.uX)(),(0,r.CE)("div",o,[(0,r.Lk)("div",n,[(0,r.bF)(X,{separator:"",bordered:""},{default:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.menu,((i,s)=>(0,r.bo)(((0,r.uX)(),(0,r.Wv)(N,{key:s,tag:"label",class:(0,a.C4)(["text-weight-medium",e.selectedSensor===i?"bg-grey-4":""])},{default:(0,r.k6)((()=>[(0,r.bF)(Q,{side:""},{default:(0,r.k6)((()=>[(0,r.bF)(C,{modelValue:e.selectedSensor,"onUpdate:modelValue":t[0]||(t[0]=t=>e.selectedSensor=t),val:i,color:"primary"},null,8,["modelValue","val"])])),_:2},1024),(0,r.bF)(Q,{avatar:""},{default:(0,r.k6)((()=>[(0,r.bF)(L,{src:"/parameters/"+i+".png"},null,8,["src"])])),_:2},1024),(0,r.bF)(Q,null,{default:(0,r.k6)((()=>[(0,r.bF)(E,null,{default:(0,r.k6)((()=>[(0,r.eW)((0,a.v_)(e.reformatLabel(i)),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class"])),[[V]]))),128))])),_:1})]),"soil_moisture"===e.selectedSensor?((0,r.uX)(),(0,r.CE)("div",c,[(0,r.bF)(T,{sensor:"soil_moisture",title:"Soil Moisture",chart:"line"})])):(0,r.Q3)("",!0),"soil_temperature"===e.selectedSensor?((0,r.uX)(),(0,r.CE)("div",u,[(0,r.bF)(T,{sensor:"soil_temperature",title:"Soil Temperature",chart:"line"})])):(0,r.Q3)("",!0),"soil_electrical_conductivity"===e.selectedSensor?((0,r.uX)(),(0,r.CE)("div",d,[(0,r.bF)(T,{sensor:"soil_electrical_conductivity",title:"Soil Electrical Conductivity",chart:"line"})])):(0,r.Q3)("",!0),"air_temperature"===e.selectedSensor?((0,r.uX)(),(0,r.CE)("div",p,[(0,r.bF)(T,{sensor:"air_temperature",title:"Air Temperature",chart:"area"})])):(0,r.Q3)("",!0),"air_pressure"===e.selectedSensor?((0,r.uX)(),(0,r.CE)("div",m,[(0,r.bF)(T,{sensor:"air_pressure",title:"Air Pressure",chart:"area"})])):(0,r.Q3)("",!0),"air_humidity"===e.selectedSensor?((0,r.uX)(),(0,r.CE)("div",y,[(0,r.bF)(T,{sensor:"air_humidity",title:"Air Humidity",chart:"area"})])):(0,r.Q3)("",!0),"rain_gauge"===e.selectedSensor?((0,r.uX)(),(0,r.CE)("div",h,[(0,r.bF)(T,{sensor:"rain_gauge",title:"Rain Gauge",chart:"area"})])):(0,r.Q3)("",!0),"wind_speed"===e.selectedSensor?((0,r.uX)(),(0,r.CE)("div",v,[(0,r.bF)(T,{sensor:"wind_speed",title:"Wind Speed",chart:"area"})])):(0,r.Q3)("",!0),"hurricane_severity_index"===e.selectedSensor?((0,r.uX)(),(0,r.CE)("div",b,[(0,r.bF)(T,{sensor:"hurricane_severity_index",title:"Hurricane Severity Index",chart:"area"})])):(0,r.Q3)("",!0),"evapotranspiration_rate"===e.selectedSensor?((0,r.uX)(),(0,r.CE)("div",g,[(0,r.bF)(T,{sensor:"evapotranspiration_rate",title:"Evapotranspiration Rate",chart:"area"})])):(0,r.Q3)("",!0),"heat_index"===e.selectedSensor?((0,r.uX)(),(0,r.CE)("div",_,[(0,r.bF)(T,{sensor:"heat_index",title:"Heat Index",chart:"area"})])):(0,r.Q3)("",!0),"visibility"===e.selectedSensor?((0,r.uX)(),(0,r.CE)("div",w,[(0,r.bF)(T,{sensor:"visibility",title:"Visibility",chart:"area"})])):(0,r.Q3)("",!0),"storm_surge"===e.selectedSensor?((0,r.uX)(),(0,r.CE)("div",f,[(0,r.bF)(T,{sensor:"storm_surge",title:"Storm Surge",chart:"area"})])):(0,r.Q3)("",!0),"water_flow"===e.selectedSensor?((0,r.uX)(),(0,r.CE)("div",k,[(0,r.bF)(T,{sensor:"water_flow",title:"Water Flow",chart:"area"})])):(0,r.Q3)("",!0),"water_level"===e.selectedSensor?((0,r.uX)(),(0,r.CE)("div",S,[(0,r.bF)(T,{sensor:"water_level",title:"Water Level",chart:"area"})])):(0,r.Q3)("",!0)]))])),_:1})}i(310),i(95),i(7225),i(8743),i(2858),i(2071),i(5520),i(2775),i(6203);var F=i(1256);const q=(0,r.pM)({name:"LocationAnalytics",components:{MyChart:F.A},data(){return{preload:!0,menu:[],selectedSensor:null,chartList:[{key:"soil_moisture",title:"Soil Moisture",type:"line"},{key:"soil_temperature",title:"Soil Temperature",type:"line"},{key:"soil_electrical_conductivity",title:"Soil Electrical Conductivity",type:"line"},{key:"air_temperature",title:"Air Temperature",type:"area"},{key:"air_pressure",title:"Air Pressure",type:"area"},{key:"air_humidity",title:"Air Humidity",type:"area"},{key:"rain_gauge",title:"Rain Gauge",type:"area"},{key:"wind_speed",title:"Wind Speed",type:"area"},{key:"hurricane_severity_index",title:"Hurricane Severity Index",type:"area"},{key:"evapotranspiration_rate",title:"Evapotranspiration Rate",type:"area"},{key:"heat_index",title:"Heat Index",type:"area"},{key:"visibility",title:"Visibility",type:"area"},{key:"storm_surge",title:"Storm Surge",type:"area"},{key:"water_flow",title:"Water Flow",type:"area"},{key:"water_level",title:"Water Level",type:"area"}],rows:{soil_moisture:[],soil_temperature:[],soil_electrical_conductivity:[],air_temperature:[],air_pressure:[],air_humidity:[],rain_gauge:[],wind_speed:[],hurricane_severity_index:[],evapotranspiration_rate:[],heat_index:[],visibility:[],storm_surge:[],water_flow:[],water_level:[]},poolSize:3,visible:{},queue:[],active:new Set,seenInViewport:new Set}},created(){const e=JSON.parse(this.client||"{}"),t=["soil_moisture","soil_temperature","soil_electrical_conductivity","air_temperature","air_humidity","air_pressure","rain_gauge","wind_speed","hurricane_severity_index","evapotranspiration_rate","heat_index","visibility","storm_surge","water_level","water_flow","battery"];t.forEach((t=>{e[t]&&this.menu.push(t)})),this.chartList.forEach((e=>{this.visible[e.key]=!1})),this.index()},methods:{reformatLabel(e){return e.replaceAll("_"," ").toUpperCase()},buildUrl(){const e=new URLSearchParams({device_uuid:this.$route.params.uuid,view_type:"Live"});return`app/sensor-series?${e.toString()}`},async index(){try{this.preload=!0;const{data:e}=await this.$api.get(this.buildUrl()),t=e?.series||{};for(const e of this.chartList){const i=Array.isArray(t[e.key])?t[e.key]:[];this.rows[e.key]=this.downsample(i,600)}}catch(e){console.error("sensor-series error",e)}finally{this.preload=!1,this.trySchedule()}},onVisible(e,t){t&&(this.seenInViewport.has(e)||(this.seenInViewport.add(e),this.queue.push(e),this.trySchedule()))},trySchedule(){while(this.active.size<this.poolSize&&this.queue.length){const e=this.queue.shift();if(this.active.has(e))continue;this.active.add(e);const t=()=>{this.visible[e]=!0};"requestIdleCallback"in window?requestIdleCallback(t,{timeout:200}):setTimeout(t,0)}},onReady(e){this.active.delete(e),this.trySchedule()},downsample(e,t=600){if(!Array.isArray(e)||e.length<=t)return e||[];const i=Math.ceil(e.length/t),r=[];for(let t=0;t<e.length;t+=i)r.push(e[t]);return r}},computed:{client(){return localStorage.getItem("client")}}});var x=i(2807),C=i(7716),Q=i(8210),L=i(3999),E=i(124),N=i(5173),X=i(7878),T=i(2665),M=i(3796),V=i(9626),I=i(8582),D=i.n(I);const O=(0,x.A)(q,[["render",A]]),R=O;D()(q,"components",{QPage:C.A,QSpinner:Q.A,QList:L.A,QItem:E.A,QItemSection:N.A,QRadio:X.A,QImg:T.A,QItemLabel:M.A}),D()(q,"directives",{Ripple:V.A})}}]);